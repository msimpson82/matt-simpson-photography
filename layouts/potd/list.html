{{ define "main" }}

<!-- Archive Hero -->
<section class="page-hero">
    <h1 class="page-hero-title">Photo Archive</h1>
    <p class="page-hero-subtitle">No client briefs, no deadlines. Just what catches my eye.</p>
</section>

<!-- Archive Grid -->
<section class="potd-archive-grid">
    <div class="potd-archive-inner">
        {{ $posts := sort .Pages "Date" "desc" }}
        {{ range $posts }}
        <div class="potd-archive-item">
            <div class="potd-archive-img">
                <img src="/images/potd/{{ .Params.image }}" alt="{{ .Title }}" loading="lazy">
            </div>
            <div class="potd-archive-info">
                <div class="potd-archive-date">{{ .Date.Format "January 2, 2006" }}</div>
                <div class="potd-archive-caption">{{ .Title }}</div>
            </div>
        </div>
        {{ end }}
    </div>
</section>

<!-- Lightbox -->
<div class="lightbox" id="lightbox">
    <button class="lightbox-close" onclick="closeLightbox()">&times;</button>
    <button class="lightbox-prev" onclick="lbNav(-1)">&#8249;</button>
    <img class="lightbox-img" id="lightboxImg" src="" alt="">
    <button class="lightbox-next" onclick="lbNav(1)">&#8250;</button>
    <div class="lightbox-counter" id="lbCounter"></div>
    <div class="lightbox-caption" id="lbCaption"></div>
</div>

<script>
(function() {
    var items = document.querySelectorAll('.potd-archive-item');
    if (!items.length) return;

    var images = [];
    items.forEach(function(item, i) {
        var img = item.querySelector('img');
        var caption = item.querySelector('.potd-archive-caption');
        images.push({ src: img.src, caption: caption ? caption.textContent : '' });
        item.style.cursor = 'pointer';
        item.addEventListener('click', function() { openLightbox(i); });
    });

    var lb = document.getElementById('lightbox');
    var lbImg = document.getElementById('lightboxImg');
    var lbCounter = document.getElementById('lbCounter');
    var lbCaption = document.getElementById('lbCaption');
    var currentLb = 0;

    window.openLightbox = function(idx) {
        currentLb = idx;
        lbImg.src = images[idx].src;
        lbCaption.textContent = images[idx].caption;
        lbCounter.textContent = (idx + 1) + ' / ' + images.length;
        lb.classList.add('active');
        document.body.style.overflow = 'hidden';
    };
    window.closeLightbox = function() {
        lb.classList.remove('active');
        document.body.style.overflow = '';
    };
    window.lbNav = function(dir) {
        currentLb += dir;
        if (currentLb < 0) currentLb = images.length - 1;
        if (currentLb >= images.length) currentLb = 0;
        lbImg.src = images[currentLb].src;
        lbCaption.textContent = images[currentLb].caption;
        lbCounter.textContent = (currentLb + 1) + ' / ' + images.length;
    };

    lb.addEventListener('click', function(e) {
        if (e.target === lb) closeLightbox();
    });
    document.addEventListener('keydown', function(e) {
        if (!lb.classList.contains('active')) return;
        if (e.key === 'Escape') closeLightbox();
        if (e.key === 'ArrowLeft') lbNav(-1);
        if (e.key === 'ArrowRight') lbNav(1);
    });
})();
</script>

{{ end }}
