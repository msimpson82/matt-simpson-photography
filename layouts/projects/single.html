{{ define "main" }}

<!-- Project Hero -->
<section class="page-hero">
    {{ if .Params.hero_image }}
    <div class="page-hero-image">
        <img src="/images/{{ .Params.hero_image }}" alt="{{ .Title }}">
    </div>
    {{ end }}
    <div class="page-breadcrumb">
        <a href="/">Home</a> / <a href="/#featured-projects">Featured Projects</a> / {{ .Title }}
    </div>
    <h1 class="page-hero-title">{{ .Title }}</h1>
    {{ if or .Params.project_type .Params.client }}
    <div class="page-meta">
        {{ with .Params.project_type }}<div class="page-meta-item"><span class="page-meta-label">Project Type</span><span class="page-meta-value">{{ . }}</span></div>{{ end }}
        {{ with .Params.client }}<div class="page-meta-item"><span class="page-meta-label">Client</span><span class="page-meta-value">{{ . }}</span></div>{{ end }}
        <div class="page-meta-item"><span class="page-meta-label">Date</span><span class="page-meta-value">{{ .Date.Format "January 2006" }}</span></div>
    </div>
    {{ end }}
</section>

<!-- Project Content -->
<section class="page-content">
    <div class="page-content-inner">
        {{ .Content }}
    </div>
</section>

<!-- Project Gallery -->
{{ if .Params.gallery }}
<section class="project-gallery-grid">
    <div class="project-gallery-inner">
        {{ range $i, $img := .Params.gallery }}
        <div class="project-gallery-item" data-lb-index="{{ $i }}">
            <img src="/images/projects/{{ $img }}" alt="{{ $.Title }} Gallery Image">
        </div>
        {{ end }}
    </div>
</section>
{{ end }}

<!-- CTA -->
<section class="page-cta">
    <div class="page-cta-inner">
        <div class="page-cta-title">Like what you see?</div>
        <p class="page-cta-text">Let's create something like this for your brand.</p>
        <a href="/#contact" class="btn-primary">Get in Touch</a>
    </div>
</section>

<!-- Lightbox -->
<div class="lightbox" id="lightbox">
    <button class="lightbox-close" onclick="closeLightbox()">&times;</button>
    <button class="lightbox-prev" onclick="lbNav(-1)">&#8249;</button>
    <img class="lightbox-img" id="lightboxImg" src="" alt="">
    <button class="lightbox-next" onclick="lbNav(1)">&#8250;</button>
    <div class="lightbox-counter" id="lbCounter"></div>
</div>

<script>
(function() {
    var items = document.querySelectorAll('.project-gallery-item');
    if (!items.length) return;

    var images = [];
    items.forEach(function(item, i) {
        var img = item.querySelector('img');
        images.push(img.src);
        item.style.cursor = 'pointer';
        item.addEventListener('click', function() { openLightbox(i); });
    });

    var lb = document.getElementById('lightbox');
    var lbImg = document.getElementById('lightboxImg');
    var lbCounter = document.getElementById('lbCounter');
    var currentLb = 0;

    window.openLightbox = function(idx) {
        currentLb = idx;
        lbImg.src = images[idx];
        lbCounter.textContent = (idx + 1) + ' / ' + images.length;
        lb.classList.add('active');
        document.body.style.overflow = 'hidden';
    };
    window.closeLightbox = function() {
        lb.classList.remove('active');
        document.body.style.overflow = '';
    };
    window.lbNav = function(dir) {
        currentLb += dir;
        if (currentLb < 0) currentLb = images.length - 1;
        if (currentLb >= images.length) currentLb = 0;
        lbImg.src = images[currentLb];
        lbCounter.textContent = (currentLb + 1) + ' / ' + images.length;
    };

    lb.addEventListener('click', function(e) {
        if (e.target === lb) closeLightbox();
    });
    document.addEventListener('keydown', function(e) {
        if (!lb.classList.contains('active')) return;
        if (e.key === 'Escape') closeLightbox();
        if (e.key === 'ArrowLeft') lbNav(-1);
        if (e.key === 'ArrowRight') lbNav(1);
    });
})();
</script>

{{ end }}
