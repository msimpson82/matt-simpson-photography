{{ define "main" }}

<!-- Project Hero -->
<section class="page-hero">
    {{ if .Params.hero_image }}
    <div class="page-hero-image">
        <img src="/images/{{ .Params.hero_image }}" alt="{{ .Title }}">
    </div>
    {{ end }}
    <div class="page-breadcrumb">
        <a href="/">Home</a> / <a href="/#featured-projects">Featured Projects</a> / {{ .Title }}
    </div>
    <h1 class="page-hero-title">{{ .Title }}</h1>
    {{ if or .Params.project_type .Params.client }}
    <div class="page-meta">
        {{ with .Params.project_type }}<div class="page-meta-item"><span class="page-meta-label">Project Type</span><span class="page-meta-value">{{ . }}</span></div>{{ end }}
        {{ with .Params.client }}<div class="page-meta-item"><span class="page-meta-label">Client</span><span class="page-meta-value">{{ . }}</span></div>{{ end }}
        <div class="page-meta-item"><span class="page-meta-label">Date</span><span class="page-meta-value">{{ .Date.Format "January 2006" }}</span></div>
    </div>
    {{ end }}
</section>

<!-- Project Content -->
<section class="page-content">
    <div class="page-content-inner">
        {{ .Content }}
    </div>
</section>

<!-- Project Gallery -->
{{ if .Params.gallery }}
<section class="project-gallery-grid">
    <div class="project-gallery-inner">
        {{ range $i, $img := .Params.gallery }}
        <div class="project-gallery-item" data-lb-index="{{ $i }}">
            <img src="/images/projects/{{ $img }}" alt="{{ $.Title }} Gallery Image">
        </div>
        {{ end }}
    </div>
</section>
{{ end }}

<!-- CTA -->
<section class="page-cta">
    <div class="page-cta-inner">
        <div class="page-cta-title">Like what you see?</div>
        <p class="page-cta-text">Let's create something like this for your brand.</p>
        <a href="/#contact" class="btn-primary">Get in Touch</a>
    </div>
</section>

<!-- Lightbox -->
<div class="lightbox" id="lightbox">
    <div class="lightbox-close" id="lightboxClose">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
    </div>
    <div class="lightbox-nav lightbox-prev" id="lightboxPrev">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="15,18 9,12 15,6"></polyline></svg>
    </div>
    <img class="lightbox-image" id="lightboxImage" src="" alt="">
    <div class="lightbox-nav lightbox-next" id="lightboxNext">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="9,18 15,12 9,6"></polyline></svg>
    </div>
    <div class="lightbox-counter" id="lightboxCounter"></div>
</div>

<script>
(function() {
    var items = document.querySelectorAll('.project-gallery-item');
    if (!items.length) return;

    var lightbox = document.getElementById('lightbox');
    var lbImg = document.getElementById('lightboxImage');
    var lbCounter = document.getElementById('lightboxCounter');
    var idx = 0;
    var images = [];

    items.forEach(function(item) {
        var img = item.querySelector('img');
        images.push({ src: img.src, alt: img.alt });
    });

    function showLb(i) {
        idx = i;
        lbImg.src = images[idx].src;
        lbImg.alt = images[idx].alt;
        lbCounter.textContent = (idx + 1) + ' / ' + images.length;
        lightbox.classList.add('active');
        document.body.style.overflow = 'hidden';
    }

    function closeLb() {
        lightbox.classList.remove('active');
        document.body.style.overflow = '';
    }

    items.forEach(function(item, i) {
        item.addEventListener('click', function() { showLb(i); });
    });

    document.getElementById('lightboxClose').addEventListener('click', closeLb);
    lightbox.addEventListener('click', function(e) { if (e.target === lightbox) closeLb(); });

    document.getElementById('lightboxPrev').addEventListener('click', function(e) {
        e.stopPropagation();
        showLb((idx - 1 + images.length) % images.length);
    });
    document.getElementById('lightboxNext').addEventListener('click', function(e) {
        e.stopPropagation();
        showLb((idx + 1) % images.length);
    });

    document.addEventListener('keydown', function(e) {
        if (!lightbox.classList.contains('active')) return;
        if (e.key === 'Escape') closeLb();
        if (e.key === 'ArrowLeft') showLb((idx - 1 + images.length) % images.length);
        if (e.key === 'ArrowRight') showLb((idx + 1) % images.length);
    });
})();
</script>

{{ end }}
